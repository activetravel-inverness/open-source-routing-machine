# ActiveTravel Inverness - Open Source Routing Machine
 
This project is a series of `Dockerfile`s with a compose/stack deploy
script that builds and starts an active travel directions service for
the Inverness area.

## Components

It is constructed from 4 main components:

- [Walking Directions](#walking-directions)
- [Cycling Directions](#cycling-directions)
- [Reverse Proxy](#reverse-proxy)
- [Example App](#example-app)

### Walking Directions

[osrm-backend-foot](./osrm-backend-foot/Dockerfile)

An extension of the osrm-backend image, this:

- downloads the Scotland OSM extract from geofabrik
- queries Nominatim for the "bounds" of the Inverness area
- creates a smaller OSM extract for just the Inverness area
- builds a routing graph for the Inverness area for generating walking
  directions

### Cycling Directions

[osrm-backend-bicycle](./osrm-backend-bicycle/Dockerfile)

As with the previous [Walking Directions](#walking-directions), this is
an extension of the osrm-backend image but this time it creates a
routing graph suitable for calculating cycling directions in the
Inverness area.

### Reverse Proxy

[osrm-nginx-reverse-proxy](./osrm-nginx-reverse-proxy/Dockerfile)

The OSRM project server can only load one routing graph at a time, so
we have to start two separate OSRM servers to provide both
[walking](#walking-directions) and
[cycling directions](#cycling-directions). These servers are hidden
behind a reverse proxy to make them appear as parts of a single
service.

This reverse proxy is an extension of the standard nginx image, so it's
also used to serve any static assets we may require.

### Example App

[Walking/Cycling Directions Comparison](./osrm-nginx-reverse-proxy/usr/share/nginx/html/index.html)

This is a small single page application that can be used to compare the
walking and cycling directions generated by the routing servers. It's
been pre-configured with a route from the marked bicycle parking within
the car-park at the top of Raining's Stairs and the bicycle parking on
Inglis Street. This allows for a comparison of the routes via Market
Brae Steps on foot and by Stephen's Brae on bicycle. 

## Running the stack

```sh
docker-compose build
docker stack deploy -c docker-compose.yml ati
```
